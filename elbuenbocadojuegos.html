<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#a0715e" />
  <title>Zona Kids - El Buen Bocado</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Outfit:wght@300;400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      /* --- COLORES EL BUEN BOCADO --- */
      --brand-color: #a0715e; /* Terracota */
      --bg-body: #fffbf2;     /* Crema suave */
      --bg-card: #ffffff;
      --text-main: #3e2b26;   /* Caf√© oscuro */
      --text-sec: #8d6e63;    /* Marr√≥n suave */
      --border: #e6ddd0;
      
      --radius-fun: 24px;
      --shadow-soft: 0 10px 30px -10px rgba(62, 43, 38, 0.1);
    }

    [data-theme="dark"] {
      --bg-body: #1e1b1a;
      --bg-card: #2d2420;
      --text-main: #f3e5dc;
      --text-sec: #d7ccc8;
      --border: #3e2b26;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    html, body { height: 100%; }

    body {
      margin: 0; 
      font-family: 'Outfit', sans-serif; 
      background-color: var(--bg-body); 
      color: var(--text-main);
      min-height: 100dvh;
      display: flex; flex-direction: column;
      transition: background-color 0.3s ease, color 0.3s ease;
      overflow-x: hidden;
      padding: max(20px, env(safe-area-inset-top)) 20px 20px;
    }

    /* --- CONTROLES SUPERIORES (Igual que Carta) --- */
    .top-controls {
      width: 100%; max-width: 500px; margin: 0 auto 20px;
      display: flex; align-items: center; justify-content: space-between;
    }

    .back-btn {
      background: transparent; border: none; font-size: 1.5rem; color: var(--text-main);
      cursor: pointer; padding: 0; line-height: 1; transition: transform 0.2s;
    }
    .back-btn:active { transform: scale(0.9); }

    .header-right { display: flex; align-items: center; gap: 10px; }

    .lang-badge {
        font-weight: 700; border: 1px solid var(--text-sec); padding: 6px 10px; 
        border-radius: 50px; font-size: 0.75rem; cursor: default; letter-spacing: 1px; opacity: 0.8;
        color: var(--text-main);
    }

    .theme-btn { 
      background: var(--bg-card); border: 1px solid var(--border); cursor: pointer; padding: 0; 
      color: var(--text-main); display: flex; align-items: center; justify-content: center;
      width: 36px; height: 36px; border-radius: 50%; font-size: 1.1rem; transition: transform 0.2s;
    }
    .theme-btn:active { transform: scale(0.9); }

    /* --- HUB MENU --- */
    .hub-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
      width: 100%; max-width: 500px; margin: 0 auto;
      animation: popIn 0.5s ease-out;
    }
    .game-card {
      background: var(--bg-card); border-radius: var(--radius-fun);
      padding: 30px 15px; display: flex; flex-direction: column;
      align-items: center; cursor: pointer; 
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft); 
      transition: transform 0.2s, border-color 0.2s;
    }
    .game-card:active { transform: scale(0.96); }
    .game-icon { font-size: 3rem; margin-bottom: 10px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.05)); }
    
    /* Fuente Fredoka solo para t√≠tulos Kids */
    .game-title { font-family: 'Fredoka', sans-serif; font-weight: 600; font-size: 1.1rem; text-align: center; color: var(--text-main); }

    /* --- CONTENEDORES DE JUEGO --- */
    .game-wrapper { display: none; flex-direction: column; align-items: center; width: 100%; max-width: 450px; padding: 15px 0; flex: 1; margin: 0 auto; justify-content: center;}
    .game-wrapper.active { display: flex; animation: slideUp 0.4s ease-out; }

    /* === MEMORY === */
    .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; max-width: 320px; margin: 0 auto; }
    .mem-card { aspect-ratio: 1; perspective: 1000px; cursor: pointer; height: 85px; }
    .mem-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
    .mem-card.flipped .mem-inner { transform: rotateY(180deg); }
    .mem-face { position: absolute; width: 100%; height: 100%; border-radius: 15px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border: 2px solid var(--border); background: var(--bg-card); transition: background 0.3s; }
    .mem-front { background: var(--brand-color); color: white; font-size: 1.5rem; font-weight: 800; border: none; }
    .mem-back { transform: rotateY(180deg); font-size: 2.2rem; }

    /* === MODAL END === */
    .modal-end { display: none; position: fixed; inset: 0; background: rgba(62, 43, 38, 0.85); z-index: 1000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
    .modal-content { background: var(--bg-card); padding: 40px 30px; border-radius: 35px; text-align: center; width: 100%; max-width: 340px; border: 1px solid var(--border); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
    .modal-content h2 { font-family: 'Fredoka'; color: var(--brand-color); font-size: 2rem; margin: 0 0 10px 0; }
    .modal-content p { font-size: 1.2rem; margin-bottom: 25px; font-weight: 600; color: var(--text-main); }

    /* BOTONES */
    .btn { padding: 16px 25px; border-radius: 16px; border: none; font-weight: 700; font-family: 'Outfit', sans-serif; cursor: pointer; font-size: 1rem; width: 100%; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-action { background: var(--brand-color); color: #fff; box-shadow: 0 10px 20px -5px rgba(160, 113, 94, 0.4); }
    .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text-sec); margin-top: 10px; }
    .btn:active { transform: scale(0.98); box-shadow: none; opacity: 0.9; }

    /* PANTALLAS DE JUEGO */
    .game-intro { text-align: center; width: 100%; background: var(--bg-card); padding: 30px; border-radius: 30px; border: 1px solid var(--border); box-shadow: var(--shadow-soft); }
    .game-intro h2 { font-family: 'Fredoka'; font-size: 1.8rem; margin: 10px 0; color: var(--brand-color); }
    .game-intro p { color: var(--text-sec); margin-bottom: 20px; }

    /* DINO & MOLE */
    #dinoCanvas { background: #fff; border-radius: 20px; border: 2px solid var(--border); width: 100%; height: 180px; }
    .mole-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
    .hole { aspect-ratio: 1; background: var(--border); border-radius: 50%; position: relative; overflow: hidden; box-shadow: inset 0 10px 10px rgba(0,0,0,0.1); }
    .mole { position: absolute; top: 100%; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; transition: top 0.1s; cursor: pointer; }
    .hole.up .mole { top: 10%; }

    .player-tag { background: var(--brand-color); color: white; padding: 6px 14px; border-radius: 50px; margin: 4px; display: inline-block; font-weight: 600; font-size: 0.9rem; }
    .setup-box { background: var(--bg-card); padding: 25px; border-radius: 25px; width: 100%; border: 1px solid var(--border); text-align: center; }
    input[type="text"] { font-family: 'Outfit'; background: var(--bg-body); color: var(--text-main); padding: 15px; border-radius: 15px; border: 2px solid var(--border); width: 100%; margin-bottom: 15px; font-size: 1rem; }
    input:focus { border-color: var(--brand-color); }

    @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>

  <div class="top-controls">
      <button class="back-btn" onclick="history.back()">‚Üê</button>
      <div class="header-right">
        <div class="lang-badge" id="langDisplay">ES</div>
        <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">‚òÄÔ∏è</button>
      </div>
  </div>

  <div id="hubMenu">
    <div class="hub-grid">
        <div class="game-card" onclick="openGame('memory')">
          <div class="game-icon">üß©</div>
          <div class="game-title" data-t="g1">Parejas</div>
        </div>
        <div class="game-card" onclick="openGame('mole')">
          <div class="game-icon">üç≥</div>
          <div class="game-title" data-t="g2">Caza Chef</div>
        </div>
        <div class="game-card" onclick="openGame('impostor')">
          <div class="game-icon">ü§´</div>
          <div class="game-title" data-t="g3">Impostor</div>
        </div>
        <div class="game-card" onclick="openGame('dino')">
          <div class="game-icon">ü¶ñ</div>
          <div class="game-title" data-t="g4">Dino Run</div>
        </div>
    </div>
  </div>

  <div id="modalEnd" class="modal-end">
      <div class="modal-content">
          <h2 id="modalMsg">¬°FIN!</h2>
          <p id="modalScore"></p>
          <button class="btn btn-action" id="btnRetry" data-t="retry">REINTENTAR üîÑ</button>
          <button class="btn btn-outline" onclick="exitToHub()" data-t="menu_btn">MEN√ö üè†</button>
      </div>
  </div>

  <div class="game-wrapper" id="game-dino">
    <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px; font-weight:800;"><span><span data-t="score">Score</span>: <span id="dScore">0</span></span></div>
    <canvas id="dinoCanvas"></canvas>
    <button class="btn btn-action" style="margin-top:20px; height:80px;" onmousedown="dJump()" ontouchstart="dJump()" data-t="jump_btn">¬°SALTAR! üëÜ</button>
    <button class="btn btn-outline" onclick="exitToHub()" data-t="back">VOLVER</button>
  </div>

  <div class="game-wrapper" id="game-mole">
    <div id="mole-intro" class="game-intro">
        <div class="game-icon">üë®‚Äçüç≥</div>
        <h2 data-t="mole_title">Caza al Chef</h2>
        <p data-t="mole_desc">¬°No dejes que se escape!</p>
        <button class="btn btn-action" onclick="startMoleGame()" data-t="start">EMPEZAR</button>
        <button class="btn btn-outline" onclick="exitToHub()" data-t="back">VOLVER</button>
    </div>
    <div id="mole-active" style="display:none; width:100%;">
        <div style="font-size: 1.5rem; font-weight: 800; margin-bottom: 20px; text-align:center;"><span data-t="mole_catch">Caza</span>: <span id="mScore">0</span></div>
        <div class="mole-grid" id="mGrid"></div>
    </div>
  </div>

  <div class="game-wrapper" id="game-memory">
    <div class="memory-grid" id="memBoard"></div>
    <button class="btn btn-outline" style="margin-top:30px" onclick="exitToHub()" data-t="back">VOLVER</button>
  </div>

  <div class="game-wrapper" id="game-impostor">
      <div id="imp-setup" style="width:100%;">
          <div class="setup-box">
              <input type="text" id="pName" placeholder="Nombre...">
              <button class="btn btn-action" onclick="addP()" data-t="add_btn">A√±adir +</button>
              <div id="pList" style="margin:20px 0;"></div>
              <button class="btn btn-action" id="startImpBtn" disabled onclick="startImp()" style="background:#22c55e" data-t="start">EMPEZAR</button>
              <button class="btn btn-outline" onclick="exitToHub()" data-t="back">VOLVER</button>
          </div>
      </div>
      <div id="imp-play" style="display:none; text-align:center; width:100%;">
          <h2 id="impTurn" style="font-family:'Fredoka'; font-size:2rem; color:var(--text-main);">Turno</h2>
          <div id="impSecret" style="display:none; font-size:1.8rem; margin:20px 0; color:var(--brand-color); font-weight:800; background:var(--bg-body); padding:20px; border-radius:20px; border:2px dashed var(--brand-color);"></div>
          <button class="btn btn-action" id="impBtn" onclick="handleImp()">VER PALABRA</button>
      </div>
  </div>

  <script>
    /* 1. DICCIONARIO DE IDIOMAS */
    const dict = {
        es: { 
            g1:"Parejas", g2:"Caza Chef", g3:"Impostor", g4:"Dino Run", 
            retry:"REINTENTAR üîÑ", menu_btn: "MEN√ö üè†", back: "VOLVER", start: "EMPEZAR",
            score: "Puntos", jump_btn: "¬°SALTAR! üëÜ", boom: "¬°BOOM!",
            mole_title: "Caza al Chef", mole_desc: "¬°No dejes que se escape!", mole_catch: "Caza", mole_msg_lost: "¬°SE ESCAP√ì!",
            win: "¬°GENIO!",
            add_btn: "A√±adir +", name_ph: "Nombre...", 
            imp_view: "VER PALABRA", imp_ready: "LISTO (OCULTAR)", imp_word: "PALABRA: ", imp_secret: "IMPOSTOR üòà", 
            imp_play_title: "¬°A JUGAR!", imp_starts: "EMPIEZA: ", imp_desc: "Debatid qui√©n es el impostor y pulsad el bot√≥n cuando est√©is listos.", imp_reveal: "REVELAR IMPOSTOR",
            imp_words: ["Pizza", "Sushi", "Taco", "Hamburguesa", "Pasta", "Helado", "Sopa"]
        },
        en: { 
            g1:"Memory", g2:"Chef Hunt", g3:"Imposter", g4:"Dino Run", 
            retry:"RETRY üîÑ", menu_btn: "MENU üè†", back: "BACK", start: "START",
            score: "Score", jump_btn: "JUMP! üëÜ", boom: "BOOM!",
            mole_title: "Catch the Chef", mole_desc: "Don't let him escape!", mole_catch: "Caught", mole_msg_lost: "HE ESCAPED!",
            win: "GENIUS!",
            add_btn: "Add +", name_ph: "Name...", 
            imp_view: "VIEW WORD", imp_ready: "READY (HIDE)", imp_word: "WORD: ", imp_secret: "IMPOSTER üòà", 
            imp_play_title: "LET'S PLAY!", imp_starts: "STARTS: ", imp_desc: "Discuss who is the imposter and press the button when ready.", imp_reveal: "REVEAL IMPOSTER",
            imp_words: ["Pizza", "Sushi", "Taco", "Burger", "Pasta", "Ice Cream", "Soup"]
        },
        de: { 
            g1:"Paare", g2:"Chef Jagd", g3:"Hochstapler", g4:"Dino Run", 
            retry:"NEU STARTEN üîÑ", menu_btn: "MEN√ú üè†", back: "ZUR√úCK", start: "STARTEN",
            score: "Punkte", jump_btn: "SPRINGEN! üëÜ", boom: "BUMM!",
            mole_title: "Fang den Chef", mole_desc: "Lass ihn nicht entkommen!", mole_catch: "Gefangen", mole_msg_lost: "ENTKOMMEN!",
            win: "GENIE!",
            add_btn: "Hinzuf√ºgen +", name_ph: "Name...", 
            imp_view: "WORT ANSEHEN", imp_ready: "BEREIT (VERSTECKEN)", imp_word: "WORT: ", imp_secret: "HOCHSTAPLER üòà", 
            imp_play_title: "LOS GEHT'S!", imp_starts: "BEGINNT: ", imp_desc: "Diskutiert, wer der Hochstapler ist, und dr√ºckt den Knopf.", imp_reveal: "ENTH√úLLEN",
            imp_words: ["Pizza", "Sushi", "Taco", "Burger", "Pasta", "Eis", "Suppe"]
        },
        fr: { 
            g1:"M√©moire", g2:"Chasse Chef", g3:"Imposteur", g4:"Dino Run", 
            retry:"R√âESSAYER üîÑ", menu_btn: "MENU üè†", back: "RETOUR", start: "COMMENCER",
            score: "Score", jump_btn: "SAUTER ! üëÜ", boom: "BOUM !",
            mole_title: "Chasse au Chef", mole_desc: "Ne le laissez pas s'√©chapper !", mole_catch: "Attrap√©", mole_msg_lost: "IL S'EST √âCHAPP√â !",
            win: "G√âNIE !",
            add_btn: "Ajouter +", name_ph: "Nom...", 
            imp_view: "VOIR LE MOT", imp_ready: "PR√äT (CACHER)", imp_word: "MOT : ", imp_secret: "IMPOSTEUR üòà", 
            imp_play_title: "JOUONS !", imp_starts: "COMMENCE : ", imp_desc: "Discutez qui est l'imposteur et appuyez sur le bouton.", imp_reveal: "R√âV√âLER",
            imp_words: ["Pizza", "Sushi", "Tacos", "Burger", "P√¢tes", "Glace", "Soupe"]
        },
        it: { 
            g1:"Memoria", g2:"Caccia allo Chef", g3:"Impostore", g4:"Dino Run", 
            retry:"RIPROVA üîÑ", menu_btn: "MENU üè†", back: "INDIETRO", start: "INIZIA",
            score: "Punti", jump_btn: "SALTA! üëÜ", boom: "BOOM!",
            mole_title: "Caccia allo Chef", mole_desc: "Non farlo scappare!", mole_catch: "Preso", mole_msg_lost: "SCAPPATO!",
            win: "GENIO!",
            add_btn: "Aggiungi +", name_ph: "Nome...", 
            imp_view: "VEDI PAROLA", imp_ready: "PRONTO (NASCONDI)", imp_word: "PAROLA: ", imp_secret: "IMPOSTORE üòà", 
            imp_play_title: "GIOCHIAMO!", imp_starts: "INIZIA: ", imp_desc: "Discutete chi √® l'impostore e premete il pulsante.", imp_reveal: "RIVELA",
            imp_words: ["Pizza", "Sushi", "Taco", "Hamburger", "Pasta", "Gelato", "Zuppa"]
        }
    };

    /* 2. INICIALIZACI√ìN */
    const urlParams = new URLSearchParams(window.location.search);
    
    // 1. Idioma
    let detectedLang = localStorage.getItem('userLang') || navigator.language.slice(0,2);
    if (!dict[detectedLang]) detectedLang = 'es';
    const t = dict[detectedLang]; 
    document.getElementById('langDisplay').innerText = detectedLang.toUpperCase();

    // 2. Aplicar traducciones
    function applyTranslations() {
        document.querySelectorAll('[data-t]').forEach(el => {
            if (t[el.dataset.t]) el.innerText = t[el.dataset.t];
        });
        document.getElementById('pName').placeholder = t.name_ph;
        document.getElementById('impBtn').innerText = t.imp_view;
    }
    applyTranslations();

    // 3. Tema
    function applySavedTheme() {
        // Mirar URL primero, luego storage
        let savedTheme = urlParams.get('theme') || localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeBtn').innerText = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }
    applySavedTheme();

    function toggleTheme() {
        const curr = document.documentElement.getAttribute('data-theme');
        const next = curr === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        document.getElementById('themeBtn').innerText = next === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }

    /* LOGICA JUEGOS */
    function openGame(id) {
        stopAllGames();
        document.getElementById('hubMenu').style.display = 'none';
        document.getElementById('modalEnd').style.display = 'none';
        document.querySelectorAll('.game-wrapper').forEach(w => w.classList.remove('active'));
        document.getElementById(`game-${id}`).classList.add('active');
        if(id !== 'mole') window[`init_${id}`]();
    }

    function exitToHub() {
        stopAllGames();
        location.reload(); 
    }

    function stopAllGames() {
        mActive = false;
        dActive = false;
        if(typeof mTimer !== 'undefined') clearTimeout(mTimer);
    }

    /* PAREJAS (MEMORY) */
    function init_memory() {
        const icons = ['üçï','üçî','üçü','üç¶','üç©','üçé']; 
        const deck = [...icons, ...icons].sort(() => Math.random() - 0.5);
        document.getElementById('memBoard').innerHTML = deck.map(i => `<div class="mem-card" onclick="flip(this)"><div class="mem-inner"><div class="mem-face mem-front">?</div><div class="mem-face mem-back">${i}</div></div></div>`).join('');
    }
    let flipped = [];
    function flip(c) {
        if(flipped.length < 2 && !c.classList.contains('flipped')) {
            c.classList.add('flipped'); flipped.push(c);
            if(flipped.length === 2) {
                if(flipped[0].innerText === flipped[1].innerText) {
                    flipped = []; if(document.querySelectorAll('.flipped').length === 12) setTimeout(()=>showGameOver(t.win, "", 'memory'), 600);
                } else {
                    setTimeout(() => { flipped.forEach(x => x.classList.remove('flipped')); flipped = []; }, 800);
                }
            }
        }
    }

    /* CAZA CHEF (MOLE) */
    let mActive = false, mSpeed = 1200, mScore = 0, mTimer;
    function init_mole() {
        document.getElementById('mole-intro').style.display = 'block';
        document.getElementById('mole-active').style.display = 'none';
    }
    function startMoleGame() {
        document.getElementById('mole-intro').style.display = 'none';
        document.getElementById('mole-active').style.display = 'block';
        mActive = true; mScore = 0; mSpeed = 1200;
        document.getElementById('mGrid').innerHTML = Array(9).fill('<div class="hole"><div class="mole" onclick="hitM(this)">üë®‚Äçüç≥</div></div>').join('');
        peepM();
    }
    function peepM() {
        if(!mActive) return;
        const holes = document.querySelectorAll('.hole');
        const h = holes[Math.floor(Math.random()*9)];
        h.classList.add('up');
        mTimer = setTimeout(() => {
            if(h.classList.contains('up') && mActive) { mActive = false; showGameOver(t.mole_msg_lost, mScore, 'mole'); }
            else if(mActive) peepM();
        }, mSpeed);
    }
    function hitM(e) {
        if(!mActive) return; mScore++; e.parentNode.classList.remove('up');
        mSpeed = Math.max(400, mSpeed - 50); document.getElementById('mScore').innerText = mScore;
        if(navigator.vibrate) navigator.vibrate(40);
    }

    /* DINO RUN */
    let dCtx, dActive = false, dScore = 0, dDino, dObs = [], dFrame = 0, dSpeed = 6;
    function init_dino() {
        const canv = document.getElementById('dinoCanvas'); dCtx = canv.getContext('2d');
        canv.width = 400; canv.height = 180;
        dDino = { x: 40, y: 130, dy: 0, jump: -12, grav: 0.7, grounded: true };
        dObs = []; dScore = 0; dActive = true; dFrame = 0; dSpeed = 6;
        requestAnimationFrame(dLoop);
    }
    function dJump() { if(dDino.grounded) { dDino.dy = dDino.jump; dDino.grounded = false; } }
    function dLoop() {
        if(!dActive) return; dCtx.clearRect(0,0,400,180);
        dDino.dy += dDino.grav; dDino.y += dDino.dy;
        if(dDino.y > 130) { dDino.y = 130; dDino.dy = 0; dDino.grounded = true; }
        dCtx.save(); dCtx.translate(dDino.x+20, dDino.y+20); dCtx.scale(-1,1);
        dCtx.font = "40px Arial"; dCtx.fillText("ü¶ñ", -20, 15); dCtx.restore();
        if(dFrame % 80 === 0) {
            let isAir = Math.random() > 0.7;
            dObs.push({ x: 400, y: isAir ? 80 : 135, type: isAir ? "ü¶Ö" : "üåµ" });
        }
        dObs.forEach((o, i) => {
            o.x -= dSpeed; dCtx.font = "30px Arial"; dCtx.fillText(o.type, o.x, o.y+20);
            if(o.x < dDino.x + 25 && o.x + 20 > dDino.x && o.y < dDino.y + 35 && o.y + 25 > dDino.y) {
                dActive = false; showGameOver(t.boom, dScore, 'dino');
            }
            if(o.x < -40) { dObs.splice(i,1); dScore++; dSpeed += 0.1; }
        });
        document.getElementById('dScore').innerText = dScore;
        dFrame++; requestAnimationFrame(dLoop);
    }

    /* IMPOSTOR */
    let players = [], impIdx, revIdx, sWord;
    function addP() {
        const n = document.getElementById('pName').value.trim();
        if(n && players.length < 8) { players.push(n); document.getElementById('pName').value = ""; renderP(); }
        document.getElementById('startImpBtn').disabled = players.length < 3;
    }
    function renderP() { document.getElementById('pList').innerHTML = players.map(p => `<span class="player-tag">${p}</span>`).join(''); }
    function startImp() {
        impIdx = Math.floor(Math.random()*players.length); revIdx = 0;
        sWord = t.imp_words[Math.floor(Math.random()*t.imp_words.length)];
        document.getElementById('imp-setup').style.display = "none";
        document.getElementById('imp-play').style.display = "block";
        updateImpUI();
    }
    function updateImpUI() {
        document.getElementById('impTurn').innerText = players[revIdx];
        document.getElementById('impSecret').style.display = "none";
        document.getElementById('impBtn').innerText = t.imp_view;
    }
    function handleImp() {
        const sec = document.getElementById('impSecret');
        if(sec.style.display === "none") {
            sec.style.display = "block"; sec.innerText = revIdx === impIdx ? t.imp_secret : t.imp_word + sWord;
            document.getElementById('impBtn').innerText = t.imp_ready;
        } else {
            revIdx++;
            if(revIdx < players.length) updateImpUI();
            else {
                const starter = players[Math.floor(Math.random()*players.length)];
                document.getElementById('imp-play').innerHTML = `
                    <h2 style="color:var(--brand-color)">${t.imp_play_title}</h2>
                    <p style="font-size:1.3rem; color:var(--text-main)">üî• ${t.imp_starts} <b>${starter}</b></p>
                    <p style="margin:20px 0; color:var(--text-sec)">${t.imp_desc}</p>
                    <button class="btn btn-action" onclick="revealImpostorFinal()">${t.imp_reveal}</button>
                    <button class="btn btn-outline" onclick="exitToHub()">${t.menu_btn}</button>
                `;
            }
        }
    }
    function revealImpostorFinal() {
        showGameOver(t.imp_reveal, players[impIdx], 'impostor');
    }

    function showGameOver(m, s, id) {
        document.getElementById('modalEnd').style.display = 'flex';
        document.getElementById('modalMsg').innerText = m;
        if (id === 'impostor') {
             document.getElementById('modalScore').innerText = s; 
        } else {
             document.getElementById('modalScore').innerText = t.score + ": " + s;
        }
        document.getElementById('btnRetry').onclick = () => openGame(id);
    }
  </script>
</body>
</html>