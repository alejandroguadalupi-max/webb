<script>
const RESTAURANT_NAME = "Restaurante Casablanca Â· Las Canteras";
const GOOGLE_MAPS_SHORT = "https://maps.app.goo.gl/CasablancaLasCanteras";
const TALLY_LINKS = { es:"https://tally.so/r/w2Qla9", en:"https://tally.so/r/w20k9D", de:"https://tally.so/r/mBN1q1", fr:"https://tally.so/r/mek0Dk" };
const FLAGS = { es:"ğŸ‡ªğŸ‡¸", en:"ğŸ‡¬ğŸ‡§", de:"ğŸ‡©ğŸ‡ª", fr:"ğŸ‡«ğŸ‡·" };

const COPY = {
  es:{pageTitle:"Â¿CÃ³mo fue tu experiencia?", subtitle:"CuÃ©ntanos en 10 segundos cÃ³mo fue todo.", publicTitle:"â­ ReseÃ±a pÃºblica", publicText:"Tu reseÃ±a nos da visibilidad en Google.", publicBtn:"Dejar reseÃ±a", publicNote:"Queda visible para todos.", privateTitle:"ğŸ“ Comentario privado", privateText:"Si algo fallÃ³, cuÃ©ntanos y lo arreglamos contigo.", privateBtn:"Enviar comentario", privateNote:"Solo lo vemos nosotros.", shareBtn:"Compartir experiencia con amigos", thanks:"Â¡Gracias por tu tiempo!"},
  en:{pageTitle:"How was your experience?", subtitle:"Tell us in 10 seconds how it went.", publicTitle:"â­ Public review", publicText:"Your review helps us on Google.", publicBtn:"Leave a review", publicNote:"Visible to everyone.", privateTitle:"ğŸ“ Private feedback", privateText:"If something went wrong, tell us and weâ€™ll fix it.", privateBtn:"Send feedback", privateNote:"Only we can see it.", shareBtn:"Share experience with friends", thanks:"Thanks for your time!"},
  de:{pageTitle:"Wie war Ihre Erfahrung?", subtitle:"ErzÃ¤hlen Sie uns in 10 Sekunden, wie alles war.", publicTitle:"â­ Ã–ffentliche Bewertung", publicText:"Ihre Bewertung hilft uns bei Google.", publicBtn:"Bewertung abgeben", publicNote:"FÃ¼r alle sichtbar.", privateTitle:"ğŸ“ Privates Feedback", privateText:"Wenn etwas schiefging, sagen Sie es uns bitte.", privateBtn:"Feedback senden", privateNote:"Nur wir kÃ¶nnen es sehen.", shareBtn:"Erfahrung mit Freunden teilen", thanks:"Vielen Dank fÃ¼r Ihre Zeit!"},
  fr:{pageTitle:"Comment Ã©tait votre expÃ©rience ?", subtitle:"Racontez-nous en 10 secondes comment tout s'est passÃ©.", publicTitle:"â­ Avis public", publicText:"Votre avis nous aide sur Google.", publicBtn:"Laisser un avis", publicNote:"Visible par tout le monde.", privateTitle:"ğŸ“ Commentaire privÃ©", privateText:"S'il y a eu un souci, dites-le nous.", privateBtn:"Envoyer un commentaire", privateNote:"Visible uniquement par nous.", shareBtn:"Partager avec des amis", thanks:"Merci pour votre temps !"}
};

const LANGS = Object.keys(COPY);

function getInitialLang(){
  // 1ï¸âƒ£ Si el usuario ya eligiÃ³ idioma antes, Ãºsalo
  const saved = localStorage.getItem('userLang');
  if(saved && COPY[saved]) return saved;

  // 2ï¸âƒ£ Si no, detectar idioma del dispositivo/navegador
  const browser = navigator.languages || [navigator.language || 'es'];
  for(const b of browser){
    const c = b.slice(0,2).toLowerCase();
    if(COPY[c]) return c;
  }

  // 3ï¸âƒ£ Si no se reconoce, volver al espaÃ±ol
  return 'es';
}

function setLang(lang){
  if(!COPY[lang]) lang='es';
  const d = COPY[lang];
  document.documentElement.lang = lang;
  document.title = d.pageTitle;
  document.getElementById('subtitle').textContent = d.subtitle;
  document.getElementById('publicTitle').textContent = d.publicTitle;
  document.getElementById('publicText').textContent = d.publicText;
  document.getElementById('btnGoogle').textContent = d.publicBtn;
  document.getElementById('publicNote').textContent = d.publicNote;
  document.getElementById('privateTitle').textContent = d.privateTitle;
  document.getElementById('privateText').textContent = d.privateText;
  document.getElementById('btnPrivate').textContent = d.privateBtn;
  document.getElementById('privateNote').textContent = d.privateNote;
  document.getElementById('openShare').textContent = "ğŸ“¸ " + d.shareBtn;
  document.getElementById('thanks').innerHTML = `<strong>${d.thanks}</strong>`;
  document.getElementById('btnGoogle').href = GOOGLE_MAPS_SHORT;
  document.getElementById('btnPrivate').href = TALLY_LINKS[lang] || TALLY_LINKS['es'];
  document.getElementById('current-lang').textContent = FLAGS[lang];
  localStorage.setItem('userLang', lang);
  document.getElementById('lang-options').style.display='none';
}

function initLangSelector(){
  const currentLangDiv = document.getElementById('current-lang');
  const optionsDiv = document.getElementById('lang-options');

  // âœ… Idioma inicial: dispositivo o guardado
  const initialLang = getInitialLang();
  setLang(initialLang);

  LANGS.forEach(code=>{
    const opt = document.createElement('div');
    opt.className='lang-option';
    opt.textContent=`${FLAGS[code]} ${code.toUpperCase()}`;
    opt.addEventListener('click',()=>setLang(code));
    optionsDiv.appendChild(opt);
  });

  currentLangDiv.addEventListener('click', e=>{
    e.stopPropagation();
    optionsDiv.style.display = optionsDiv.style.display==='block'?'none':'block';
  });

  document.addEventListener('click', e=>{
    if(!document.getElementById('lang-selector').contains(e.target)){
      optionsDiv.style.display='none';
    }
  });
}

document.addEventListener('DOMContentLoaded', initLangSelector);
</script>
