<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Compartir experiencia ¬∑ Casablanca</title>
<style>
:root{
  --text:#0b0f18; --muted:#6b7280; --accent:#2563eb;
  --bg:#f9fafb; --border:#e5e7eb;
}
*{box-sizing:border-box;}
body{
  margin:0; font-family:system-ui,-apple-system,Roboto,sans-serif;
  background:var(--bg); color:var(--text);
  display:flex; justify-content:center; align-items:center; padding:16px;
  min-height:100svh;
  position:relative;
}
.wrap{
  width:100%; max-width:420px; display:flex; flex-direction:column; align-items:center;
}
header{
  width:100%; display:flex; align-items:center; justify-content:flex-start; margin-bottom:16px;
  position:absolute; top:16px; left:16px; right:16px; z-index:10;
}
.back{
  background:rgba(0,0,0,.05); padding:8px 10px; border-radius:10px;
  text-decoration:none; color:var(--text); font-weight:700; font-size:15px;
}
.share-card{
  background:#fff; border-radius:14px; padding:20px;
  border:1px solid var(--border); box-shadow:0 8px 20px rgba(0,0,0,.06);
  width:100%; display:flex; flex-direction:column; align-items:center;
  max-width:100%;
  min-height:200px; /* altura base */
}
h2{margin:0 0 6px; font-size:18px; text-align:center;}
p{margin:0 0 10px; font-size:14px; text-align:center;}
.photo-preview{
  width:100%; max-height:250px; border-radius:10px;
  object-fit:cover; display:none; margin-bottom:10px;
  border:1px solid var(--border);
}
.row{display:flex; gap:8px; justify-content:center; margin-bottom:12px; width:100%;}
.btn{
  flex:1; padding:12px 0; border-radius:10px; border:0;
  font-weight:700; cursor:pointer; font-size:15px;
}
.btn-yellow{background:linear-gradient(180deg,#fde047,#facc15);color:#000;}
.btn-blue{background:linear-gradient(180deg,#6baeff,var(--accent));color:#fff;}
.btn-ghost{background:transparent;border:1px solid var(--border);color:var(--muted);}
.note{
  text-align:center;color:var(--muted); font-size:13px; line-height:1.3; margin-top:4px;
}
#lang-selector{position:absolute; top:16px; right:16px;}
#current-lang{cursor:pointer; background:rgba(0,0,0,.05); padding:6px 8px; border-radius:8px;}
#lang-options{
  display:none; position:absolute; right:0; top:40px; background:#fff;
  border:1px solid var(--border); border-radius:10px;
  box-shadow:0 8px 20px rgba(0,0,0,.08); z-index:40;
}
.lang-option{padding:8px 10px; cursor:pointer; font-weight:700;}
.modal{
  position:fixed; inset:0; background:rgba(0,0,0,.5);
  display:none; align-items:center; justify-content:center; z-index:100;
}
.modal-content{
  background:#fff; padding:18px 24px; border-radius:12px;
  text-align:center; font-weight:600; color:var(--text);
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}
</style>
</head>
<body>

<div id="lang-selector">
  <div id="current-lang">üá™üá∏</div>
  <div id="lang-options"></div>
</div>

<div class="wrap" role="main">
  <header>
    <a id="backBtn" class="back" href="restaurante_casablanca.html" aria-label="Volver">‚¨Ö Volver</a>
  </header>

  <div class="share-card" aria-labelledby="shareTitle">
    <h2 id="shareTitle">üì∏ Comparte tu momento</h2>
    <p id="shareSub">Elige o toma una foto y comp√°rtela con tus amigos.</p>

    <img id="photoPreview" class="photo-preview" alt="Vista previa">

    <input type="file" id="photoInput" accept="image/*" style="display:none;">

    <div class="row">
      <button id="btnPhoto" class="btn btn-yellow">üì∑ Tomar o elegir</button>
      <button id="btnRetake" class="btn btn-ghost" style="display:none;">üîÅ Repetir</button>
    </div>

    <button id="btnShare" class="btn btn-blue">Compartir</button>
    <p class="note" id="note">Si no eliges foto, se compartir√° una tarjeta minimalista del restaurante.</p>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modal-content" id="modalMsg">¬°Gracias por compartir üíõ!</div>
</div>

<script>
const RESTAURANT_NAME = "Terraza Casablanca Las Canteras";
const GOOGLE_MAPS_SHORT = "https://maps.app.goo.gl/CasablancaLasCanteras";
const DEFAULT_CARD = "img/imagen_circular_recortada.png";

const FLAGS = { es:"üá™üá∏", en:"üá¨üáß", de:"üá©üá™", fr:"üá´üá∑" };
const COPY = {
  es:{shareTitle:"üì∏ Comparte tu momento",shareSub:"Elige o toma una foto y comp√°rtela con tus amigos.",shareMsg:`Acabo de disfrutar en ${RESTAURANT_NAME} üç∏‚ú® ¬°Tienes que venir!`,note:"Si no eliges foto, se compartir√° una tarjeta minimalista del restaurante.",back:"‚¨Ö Volver",shareBtn:"Compartir",sharedOK:"¬°Gracias por compartir tu momento üíõ!"},
  en:{shareTitle:"üì∏ Share your moment",shareSub:"Take or choose a photo and share with friends.",shareMsg:`Just had a great time at ${RESTAURANT_NAME} üç∏‚ú® Highly recommended!`,note:"If you don't choose a photo, a minimal restaurant card will be shared.",back:"‚¨Ö Back",shareBtn:"Share",sharedOK:"Thanks for sharing üíõ!"},
  de:{shareTitle:"üì∏ Teile deinen Moment",shareSub:"Mach ein Foto oder w√§hle eins und teile es mit Freunden.",shareMsg:`Ich habe gerade ${RESTAURANT_NAME} genossen üç∏‚ú® Sehr empfehlenswert!`,note:"Wenn du kein Foto ausw√§hlst, wird eine minimalistische Karte geteilt.",back:"‚¨Ö Zur√ºck",shareBtn:"Teilen",sharedOK:"Danke f√ºrs Teilen üíõ!"},
  fr:{shareTitle:"üì∏ Partage ton moment",shareSub:"Prends ou choisis une photo et partage-la avec tes amis.",shareMsg:`Je viens de profiter de ${RESTAURANT_NAME} üç∏‚ú® √Ä ne pas manquer !`,note:"Si vous ne choisissez pas de photo, une carte minimaliste sera partag√©e.",back:"‚¨Ö Retour",shareBtn:"Partager",sharedOK:"Merci d‚Äôavoir partag√© üíõ!"}
};

function getInitialLang(){
  const s = localStorage.getItem('userLang');
  if(s && COPY[s]) return s;
  const bl = navigator.languages || [navigator.language || 'es'];
  for(const b of bl){ const c = b.slice(0,2); if(COPY[c]) return c; }
  return 'es';
}

let currentLang = getInitialLang();
const currentLangEl = document.getElementById('current-lang');
const langOptions = document.getElementById('lang-options');
const photoInput = document.getElementById('photoInput');
const photoPreview = document.getElementById('photoPreview');
const btnPhoto = document.getElementById('btnPhoto');
const btnRetake = document.getElementById('btnRetake');
const btnShare = document.getElementById('btnShare');
const modal = document.getElementById('modal');
const modalMsg = document.getElementById('modalMsg');
let selectedFile = null;

function buildLangOptions(){
  langOptions.innerHTML = '';
  Object.keys(COPY).forEach(code=>{
    const d = document.createElement('div');
    d.className='lang-option';
    d.textContent = `${FLAGS[code]} ${code.toUpperCase()}`;
    d.addEventListener('click', ()=> setLang(code));
    langOptions.appendChild(d);
  });
  currentLangEl.addEventListener('click', e=>{
    e.stopPropagation();
    langOptions.style.display = langOptions.style.display==='block'?'none':'block';
  });
  document.addEventListener('click', ev=>{
    if(!document.getElementById('lang-selector').contains(ev.target))
      langOptions.style.display='none';
  });
}

function setLang(lang){
  if(!COPY[lang]) lang='es';
  currentLang = lang;
  localStorage.setItem('userLang', lang);
  const c = COPY[lang];
  document.getElementById('shareTitle').textContent = c.shareTitle;
  document.getElementById('shareSub').textContent = c.shareSub;
  document.getElementById('note').textContent = c.note;
  document.getElementById('btnShare').textContent = c.shareBtn;
  document.getElementById('backBtn').textContent = c.back;
  currentLangEl.textContent = FLAGS[lang];
  langOptions.style.display='none';
}

buildLangOptions();
setLang(currentLang);

/* Foto */
btnPhoto.addEventListener('click', ()=> photoInput.click());
photoInput.addEventListener('change', e=>{
  const f = e.target.files?.[0];
  if(!f) return;
  selectedFile = f;
  photoPreview.src = URL.createObjectURL(f);
  photoPreview.style.display = 'block';
  btnRetake.style.display = 'inline-block';
  document.getElementById('note').textContent = "‚úÖ Previsualiza tu foto. Si no te gusta, pulsa 'Repetir'.";
});

btnRetake.addEventListener('click', ()=>{
  photoInput.value = '';
  selectedFile = null;
  photoPreview.src = '';
  photoPreview.style.display = 'none';
  btnRetake.style.display = 'none';
  setLang(currentLang);
});

/* Compartir */
async function shareExperience(e){
  e && e.preventDefault();
  const dict = COPY[currentLang];
  const text = `${dict.shareMsg}\nüìç ${RESTAURANT_NAME}\n${GOOGLE_MAPS_SHORT}`;
  let fileToShare = selectedFile;

  if(!fileToShare){
    try{
      const res = await fetch(DEFAULT_CARD);
      const blob = await res.blob();
      fileToShare = new File([blob], "casablanca.jpg", {type: blob.type});
    }catch{}
  }

  const shareData = { text };
  if(fileToShare && navigator.canShare && navigator.canShare({ files: [fileToShare] }))
    shareData.files = [fileToShare];

  try{
    if(navigator.share){
      await navigator.share(shareData);
      showModal(dict.sharedOK);
      btnRetake.click();
    }else{
      await navigator.clipboard.writeText(text);
      showModal("Copiado al portapapeles ‚úÖ");
    }
  }catch(err){ console.log("cancelado o error", err); }
}

function showModal(msg){
  modalMsg.textContent = msg;
  modal.style.display='flex';
  setTimeout(()=> modal.style.display='none', 2500);
}

btnShare.addEventListener('click', shareExperience);
</script>
</body>
</html>


