<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, maximum-scale=1" />
<title>Carta</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  /* Variables de Color (Premium & Glass) */
  --bg-light: #F9FAFB;
  --bg-dark: #0D0D0D;
  
  --card-light: #FFFFFF;
  --card-dark: #1C1C1E;
  
  --text-light: #1F2937;
  --text-dark: #F3F4F6;
  
  --muted-light: #6B7280;
  --muted-dark: #9CA3AF;
  
  --accent: #68B553; 
  --accent-text: #ffffff;
  
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
  --shadow-float: 0 20px 40px -10px rgba(104, 181, 83, 0.3);
  
  --radius: 20px;
  --font: 'Plus Jakarta Sans', sans-serif;
}

[data-theme="dark"] {
  --bg: var(--bg-dark);
  --card: var(--card-dark);
  --text: var(--text-dark);
  --muted: var(--muted-dark);
  --border: rgba(255,255,255,0.08);
  --glass: rgba(28, 28, 30, 0.85);
  --btn-bg: rgba(255,255,255,0.1);
}

[data-theme="light"] {
  --bg: var(--bg-light);
  --card: var(--card-light);
  --text: var(--text-light);
  --muted: var(--muted-light);
  --border: rgba(0,0,0,0.06);
  --glass: rgba(255, 255, 255, 0.85);
  --btn-bg: #f3f4f6;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font);
  transition: background 0.3s ease, color 0.3s ease;
  padding-bottom: 120px; /* Espacio para bot√≥n flotante */
}

/* --- Header Glassmorphism --- */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--glass);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--border);
}

.brand {
  font-size: 1.4rem;
  font-weight: 800;
  letter-spacing: -0.5px;
}

.controls { display: flex; align-items: center; gap: 12px; }

/* Selector de idioma (visualizaci√≥n) */
.lang-display {
  font-size: 0.9rem;
  font-weight: 700;
  text-transform: uppercase;
  color: var(--muted);
  border: 1px solid var(--border);
  padding: 4px 8px;
  border-radius: 8px;
}

.theme-toggle {
  background: none; border: none; cursor: pointer; padding: 5px;
  color: var(--text); display: flex; align-items: center;
}

/* --- Filtros --- */
.filters-wrap {
  position: sticky;
  top: 73px; 
  z-index: 90;
  background: var(--bg);
  padding: 12px 0;
  margin-bottom: 10px;
}

.filters-scroll {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding: 0 20px;
  scrollbar-width: none;
}
.filters-scroll::-webkit-scrollbar { display: none; }

.filter-chip {
  padding: 8px 20px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 50px;
  white-space: nowrap;
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--muted);
  cursor: pointer;
  transition: all 0.2s ease;
}

.filter-chip.active {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* --- Grid Productos --- */
.menu-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
  padding: 0 20px;
  max-width: 1000px;
  margin: 0 auto;
}

.product-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 20px;
  border: 1px solid var(--border);
  transition: transform 0.2s;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.product-card:active { transform: scale(0.99); }

.card-top {
  display: flex; justify-content: space-between; align-items: flex-start;
  margin-bottom: 6px;
}

.product-name {
  font-weight: 700; font-size: 1.15rem; line-height: 1.3; margin-right: 10px;
}

.product-price {
  font-weight: 700; font-size: 1.15rem; color: var(--accent); white-space: nowrap;
}

.product-desc {
  font-size: 0.95rem; color: var(--muted); line-height: 1.5; margin-bottom: 20px; flex: 1;
}

.card-footer {
  display: flex; justify-content: flex-end; /* Bot√≥n a la derecha */
  align-items: center;
}

/* Bot√≥n A√±adir con Contador */
.add-btn {
  background: var(--btn-bg);
  color: var(--text);
  border: none;
  min-width: 44px;
  height: 44px;
  padding: 0 16px; /* Padding lateral para cuando crece */
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: var(--shadow-sm);
}

.add-btn:active { transform: scale(0.95); }

/* Estado cuando hay items */
.add-btn.has-items {
  background: var(--accent);
  color: white;
  min-width: 70px; /* M√°s ancho */
}

/* --- Bot√≥n Flotante (Pedido) --- */
#cart-float {
  position: fixed;
  bottom: 24px; left: 50%;
  transform: translateX(-50%) scale(0.9) translateY(100px);
  background: var(--text); 
  color: var(--bg);
  padding: 16px 28px;
  border-radius: 50px;
  display: flex; align-items: center; gap: 16px;
  box-shadow: var(--shadow-float);
  cursor: pointer; z-index: 1000;
  transition: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  font-weight: 600;
}

#cart-float.visible { transform: translateX(-50%) scale(1) translateY(0); }
.badge-count { background: var(--accent); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.85rem; }

/* --- Panel Deslizante (Bottom Sheet) --- */
.overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
  z-index: 2000; opacity: 0; pointer-events: none; transition: 0.3s;
  display: flex; justify-content: center; align-items: flex-end;
}
.overlay.open { opacity: 1; pointer-events: auto; }

.sheet {
  background: var(--card); width: 100%; max-width: 600px; max-height: 85vh;
  border-radius: 30px 30px 0 0; padding: 24px; display: flex; flex-direction: column;
  transform: translateY(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.overlay.open .sheet { transform: translateY(0); }

.sheet-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px;
}

.order-items { overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 12px; }

.order-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px; background: var(--bg); border-radius: 16px;
}

.qty-wrap { display: flex; align-items: center; gap: 12px; }
.q-btn {
  width: 32px; height: 32px; border-radius: 50%; border: none;
  background: var(--card); color: var(--text); font-weight: bold;
  box-shadow: var(--shadow-sm); cursor: pointer;
}

.waiter-note {
  background: rgba(104, 181, 83, 0.1); color: var(--accent); padding: 14px;
  border-radius: 16px; margin-top: 16px; text-align: center; font-weight: 600; font-size: 0.9rem;
}

</style>
</head>
<body>

<header class="header">
  <div class="brand">Carta</div>
  <div class="controls">
    <div class="lang-display" id="langDisplay">ES</div>
    <button class="theme-toggle" id="themeBtn">
      </button>
  </div>
</header>

<div class="filters-wrap">
  <div class="filters-scroll">
    <div class="filter-chip active" onclick="filter('all')" id="f-all">Todos</div>
    <div class="filter-chip" onclick="filter('entrantes')" id="f-ent">Entrantes</div>
    <div class="filter-chip" onclick="filter('principales')" id="f-main">Principales</div>
    <div class="filter-chip" onclick="filter('postres')" id="f-des">Postres</div>
  </div>
</div>

<div class="menu-grid" id="menuContainer">
  </div>

<div id="cart-float" onclick="openSheet()">
  <span class="badge-count" id="countBadge">0</span>
  <span id="btnText">Ver Pedido</span>
  <span id="totalPrice" style="margin-left:auto; opacity:0.8">0.00‚Ç¨</span>
</div>

<div class="overlay" id="overlay" onclick="if(event.target===this) closeSheet()">
  <div class="sheet">
    <div class="sheet-header">
      <h3 style="margin:0; font-size:1.4rem" id="modalTitle">Tu Pedido</h3>
      <div onclick="closeSheet()" style="cursor:pointer; padding:5px; font-weight:bold">‚úï</div>
    </div>
    
    <div class="order-items" id="orderList">
      </div>

    <div class="waiter-note" id="waiterMsg">
      üí° Lee esta lista al camarero/a para pedir.
    </div>

    <button onclick="clearCart()" style="width:100%; margin-top:15px; background:transparent; border:none; color:var(--muted); font-size:0.9rem; text-decoration:underline; cursor:pointer;">
      <span id="clearTxt">Borrar lista</span>
    </button>
  </div>
</div>

<script>
/* --- TRADUCCIONES (ES, EN, DE, FR, IT) --- */
const i18n = {
  es: {
    all: "Todos", ent: "Entrantes", main: "Principales", des: "Postres",
    btn: "Ver Pedido", title: "Tu Pedido",
    msg: "üí° Lee esta lista al camarero/a para pedir.",
    clear: "Borrar todo", empty: "Lista vac√≠a"
  },
  en: {
    all: "All", ent: "Starters", main: "Mains", des: "Desserts",
    btn: "View Order", title: "Your Order",
    msg: "üí° Read this list to the waiter to order.",
    clear: "Clear all", empty: "Empty list"
  },
  de: {
    all: "Alle", ent: "Vorspeisen", main: "Hauptspeisen", des: "Desserts",
    btn: "Bestellung ansehen", title: "Deine Bestellung",
    msg: "üí° Lies diese Liste dem Kellner vor.",
    clear: "Alles l√∂schen", empty: "Leere Liste"
  },
  fr: {
    all: "Tous", ent: "Entr√©es", main: "Plats", des: "Desserts",
    btn: "Voir la commande", title: "Votre Commande",
    msg: "üí° Lisez cette liste au serveur pour commander.",
    clear: "Tout effacer", empty: "Liste vide"
  },
  it: {
    all: "Tutti", ent: "Antipasti", main: "Primi/Secondi", des: "Dolci",
    btn: "Vedi Ordine", title: "Il tuo Ordine",
    msg: "üí° Leggi questo elenco al cameriere per ordinare.",
    clear: "Cancella tutto", empty: "Lista vuota"
  }
};

/* --- DATOS DE LA CARTA --- */
const menu = [
  { id: 1, cat: 'entrantes', price: 6.50,
    name: { es: "Croquetas Caseras", en: "Homemade Croquettes", de: "Hausgemachte Kroketten", fr: "Croquettes maison", it: "Crocchette Fatte in Casa" },
    desc: { es: "De jam√≥n ib√©rico (4 uds).", en: "Iberian ham (4 pcs).", de: "Iberischer Schinken (4 Stk).", fr: "Jambon ib√©rique (4 pcs).", it: "Prosciutto iberico (4 pz)." }
  },
  { id: 2, cat: 'entrantes', price: 9.00,
    name: { es: "Ensalada de Quinoa", en: "Quinoa Salad", de: "Quinoa Salat", fr: "Salade de Quinoa", it: "Insalata di Quinoa" },
    desc: { es: "Con aguacate, mango y lima.", en: "With avocado, mango and lime.", de: "Mit Avocado, Mango und Limette.", fr: "√Ä l'avocat, mangue et citron vert.", it: "Con avocado, mango e lime." }
  },
  { id: 3, cat: 'entrantes', price: 7.50,
    name: { es: "Patatas Bravas", en: "Patatas Bravas", de: "Patatas Bravas", fr: "Patatas Bravas", it: "Patatas Bravas" },
    desc: { es: "Salsa picante secreta y alioli.", en: "Secret spicy sauce and aioli.", de: "Geheime scharfe Sauce und Aioli.", fr: "Sauce piquante secr√®te et a√Øoli.", it: "Salsa piccante segreta e aioli." }
  },
  { id: 4, cat: 'principales', price: 14.50,
    name: { es: "Salm√≥n Grill√©", en: "Grilled Salmon", de: "Gegrillter Lachs", fr: "Saumon grill√©", it: "Salmone alla Griglia" },
    desc: { es: "Con verduras al vapor.", en: "With steamed vegetables.", de: "Mit ged√ºnstetem Gem√ºse.", fr: "Aux l√©gumes cuits √† la vapeur.", it: "Con verdure al vapore." }
  },
  { id: 5, cat: 'principales', price: 12.00,
    name: { es: "Burger Cl√°sica", en: "Classic Burger", de: "Klassischer Burger", fr: "Burger Classique", it: "Burger Classico" },
    desc: { es: "Ternera 100%, queso y salsa.", en: "100% Beef, cheese and sauce.", de: "100% Rindfleisch, K√§se und Sauce.", fr: "100% B≈ìuf, fromage et sauce.", it: "Manzo 100%, formaggio e salsa." }
  },
  { id: 6, cat: 'postres', price: 5.50,
    name: { es: "Tarta de Queso", en: "Cheesecake", de: "K√§sekuchen", fr: "G√¢teau au fromage", it: "Cheesecake" },
    desc: { es: "Cremosa al horno.", en: "Baked creamy cake.", de: "Cremig gebacken.", fr: "Cr√©meux au four.", it: "Cremosa al forno." }
  }
];

/* --- ESTADO --- */
let cart = {};
let currentFilter = 'all';
let currentLang = 'es';

/* --- INICIALIZACI√ìN DE IDIOMA --- */
function initLanguage() {
  const urlParams = new URLSearchParams(window.location.search);
  const paramLang = urlParams.get('lang');
  const savedLang = localStorage.getItem('userLang');
  const browserLang = navigator.language.slice(0,2);
  const supported = ['es', 'en', 'de', 'fr', 'it'];
  
  if (paramLang && supported.includes(paramLang)) {
    currentLang = paramLang;
  } else if (savedLang && supported.includes(savedLang)) {
    currentLang = savedLang;
  } else if (supported.includes(browserLang)) {
    currentLang = browserLang;
  }
  
  // Guardamos para consistencia
  localStorage.setItem('userLang', currentLang);
  document.getElementById('langDisplay').innerText = currentLang;
  
  render();
}

/* --- RENDERIZADO --- */
function render() {
  const container = document.getElementById('menuContainer');
  container.innerHTML = '';
  const txt = i18n[currentLang];

  // Actualizar textos UI
  document.getElementById('f-all').innerText = txt.all;
  document.getElementById('f-ent').innerText = txt.ent;
  document.getElementById('f-main').innerText = txt.main;
  document.getElementById('f-des').innerText = txt.des;
  document.getElementById('btnText').innerText = txt.btn;
  document.getElementById('modalTitle').innerText = txt.title;
  document.getElementById('waiterMsg').innerText = txt.msg;
  document.getElementById('clearTxt').innerText = txt.clear;

  menu.forEach(p => {
    // Filtro simple por categor√≠a
    if(currentFilter !== 'all' && p.cat !== currentFilter) return;

    // Verificar si hay cantidad en el carrito para este item
    const qty = cart[p.id] || 0;
    
    // L√≥gica del texto y estilo del bot√≥n
    let btnContent = '+';
    let btnClass = 'add-btn';
    
    if (qty > 0) {
      btnContent = `${qty} +`; // Muestra "1 +", "2 +"
      btnClass += ' has-items';
    }

    container.innerHTML += `
      <div class="product-card">
        <div class="card-top">
          <div class="product-name">${p.name[currentLang]}</div>
          <div class="product-price">${p.price.toFixed(2)}‚Ç¨</div>
        </div>
        <div class="product-desc">${p.desc[currentLang]}</div>
        <div class="card-footer">
          <button class="${btnClass}" onclick="add(${p.id})">${btnContent}</button>
        </div>
      </div>
    `;
  });
}

/* --- L√ìGICA CARRITO --- */
function add(id) {
  cart[id] = (cart[id] || 0) + 1;
  // Re-renderizamos para actualizar el bot√≥n espec√≠fico (mostrando "1+", "2+", etc.)
  render(); 
  updateFloatBtn();
  
  if(navigator.vibrate) navigator.vibrate(10);
}

function remove(id) {
  if(cart[id]) {
    cart[id]--;
    if(cart[id] <= 0) delete cart[id];
  }
  render(); // Actualiza los botones de la carta
  renderCartList(); // Actualiza la lista modal si est√° abierta
  updateFloatBtn();
}

function updateFloatBtn() {
  const count = Object.values(cart).reduce((a,b)=>a+b,0);
  let total = 0;
  Object.keys(cart).forEach(id => {
    const p = menu.find(i=>i.id == id);
    if(p) total += p.price * cart[id];
  });
  
  document.getElementById('countBadge').innerText = count;
  document.getElementById('totalPrice').innerText = total.toFixed(2) + '‚Ç¨';
  
  const btn = document.getElementById('cart-float');
  if(count > 0) btn.classList.add('visible');
  else btn.classList.remove('visible');
}

function renderCartList() {
  const list = document.getElementById('orderList');
  list.innerHTML = '';
  
  if(Object.keys(cart).length === 0) {
    list.innerHTML = `<div style="text-align:center; padding:20px; color:var(--muted)">${i18n[currentLang].empty}</div>`;
    return;
  }

  Object.keys(cart).forEach(id => {
    const p = menu.find(i=>i.id == id);
    const qty = cart[id];
    list.innerHTML += `
      <div class="order-row">
        <div>
          <div style="font-weight:700">${p.name[currentLang]}</div>
          <div style="font-size:0.85rem; color:var(--muted)">${p.price.toFixed(2)}‚Ç¨ x ${qty}</div>
        </div>
        <div class="qty-wrap">
          <button class="q-btn" onclick="remove(${id})">-</button>
          <span style="font-weight:600; min-width:15px; text-align:center">${qty}</span>
          <button class="q-btn" onclick="add(${id}); renderCartList()">+</button>
        </div>
      </div>
    `;
  });
}

function clearCart() {
  cart = {};
  render();
  updateFloatBtn();
  closeSheet();
}

/* --- UI HELPERS --- */
function filter(cat) {
  currentFilter = cat;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  // Mapeo simple de ID
  let id = 'f-all';
  if(cat==='entrantes') id='f-ent';
  if(cat==='principales') id='f-main';
  if(cat==='postres') id='f-des';
  document.getElementById(id).classList.add('active');
  render();
}

function openSheet() { renderCartList(); document.getElementById('overlay').classList.add('open'); }
function closeSheet() { document.getElementById('overlay').classList.remove('open'); }

/* --- THEME --- */
const themeBtn = document.getElementById('themeBtn');
let isDark = localStorage.getItem('theme') === 'dark'; // Sincronizado con localStorage de principal
function applyTheme() {
  document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
  themeBtn.innerHTML = isDark 
    ? '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'
    : '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';
}
themeBtn.addEventListener('click', () => {
  isDark = !isDark;
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  applyTheme();
});

// Inicializar
applyTheme();
initLanguage();

</script>
</body>
</html>