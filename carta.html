<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
<title>Carta</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f4f4f4;
  --card:#ffffff;
  --text:#262626;
  --muted:#6d6d6d;
  --accent:#68B553;
  --maxw:900px;
  --gap:16px;
  --radius:20px;
  --shadow:0 8px 26px rgba(0,0,0,0.08);
}
[data-theme="dark"]{
  --bg:#111213;
  --card:#1a1b1d;
  --text:#e8e8e8;
  --muted:#a5a5a5;
  --accent:#5fa249;
  --shadow:0 8px 30px rgba(0,0,0,0.45);
}
*{box-sizing:border-box;}
body{margin:0;background:var(--bg);color:var(--text);font-family:"Inter", sans-serif;line-height:1.5;}
.wrap{max-width:var(--maxw);padding:18px;margin:auto;}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
.back-btn{text-decoration:none;padding:10px 16px;background:var(--card);color:var(--text);border-radius:var(--radius);box-shadow:var(--shadow);font-weight:600;transition:.25s;}
.back-btn:hover{transform:scale(1.05);} 
.controls{display:flex; gap:10px; align-items:center;}
.theme-switch-container{display:flex;align-items:center;}
.theme-switch{position:relative; width:52px; height:30px;}
.theme-switch input{display:none;}
.slider{width:100%; height:100%; border-radius:50px; position:relative; background:#ccc;}
.slider:before{content:""; position:absolute; width:24px; height:24px; border-radius:50%; background:#fff; top:3px; left:3px; transition:.25s;}
[data-theme="dark"] .slider{background:#68B553;}
.theme-switch input:checked + .slider:before{transform:translateX(22px);} 
.card{background:var(--card); padding:22px; border-radius:var(--radius); box-shadow:var(--shadow);}
h1{font-size:2rem; margin:0; font-weight:700; text-align:center; flex:1;}
h2{margin:0 0 12px; color:var(--accent); font-size:1.3rem; font-weight:700;}
ul.menu{list-style:none; padding:0; display:flex; flex-direction:column; gap:16px;}
li.item{display:flex; justify-content:space-between; gap:16px; padding:14px; background:rgba(255,255,255,0.08); border-radius:var(--radius); transition:.25s;}
[data-theme="dark"] li.item{background:rgba(255,255,255,0.05);}
.name{font-size:1.05rem; font-weight:700;}
.desc{font-size:0.95rem; color:var(--muted);} 
.price{font-weight:700; white-space:nowrap;}
.add-btn{margin-top:8px; background:var(--accent); color:white; padding:6px 12px; border-radius:10px; font-size:0.85rem; cursor:pointer; border:none;}
#pedidoBtn{position:fixed; bottom:20px; right:20px; background:var(--accent); padding:14px 22px; border-radius:50px; color:white; font-weight:700; display:none; box-shadow:var(--shadow);}
#panelPedido{position:fixed; bottom:0; left:0; right:0; background:var(--card); border-radius:22px 22px 0 0; box-shadow:0 -10px 30px rgba(0,0,0,.35); padding:24px; display:none; max-height:80vh; overflow-y:auto;}
#panelPedido h3{text-align:center; margin-top:0; display:flex; justify-content:space-between; align-items:center;}
#panelPedido h3 span.close-btn{cursor:pointer;font-size:1.2rem;color:var(--muted);}
.pedido-item{display:flex; justify-content:space-between; gap:10px; padding:10px 0; border-bottom:1px solid rgba(0,0,0,0.15);}
textarea.nota-general{width:100%; margin-top:12px; border-radius:10px; border:1px solid rgba(0,0,0,0.2); padding:8px; resize:none; font-size:0.9rem;}
.remove-btn{color:var(--accent); font-weight:700; cursor:pointer;}
.filter-container{margin-bottom:14px; display:flex; gap:12px; flex-wrap:wrap;}
.filter-btn{padding:6px 12px; border-radius:10px; border:1px solid var(--accent); cursor:pointer; background:var(--card); font-weight:600; transition:.2s;}
.filter-btn.active{background:var(--accent); color:#fff;}
</style>
</head>
<body>

<div class="wrap">
  <header>
    <a class="back-btn" href="principal.html">← Inicio</a>
    <h1>Carta</h1>
    <div class="controls">
      <div class="theme-switch-container">
        <label class="theme-switch">
          <input type="checkbox" id="theme-toggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </header>

  <div class="filter-container">
    <button class="filter-btn" data-allerg="gluten">Sin gluten</button>
    <button class="filter-btn" data-allerg="lactosa">Sin lactosa</button>
    <button class="filter-btn" data-allerg="none">Todos</button>
  </div>

  <div class="card">

    <section>
      <h2>Entrantes / Tapas</h2>
      <ul class="menu">
        <li class="item" data-allergies="lactosa"><div class="info"><div class="name">Croquetas de la abuela</div><div class="desc">Cremosas, con jamón ibérico y queso manchego.</div><button class="add-btn" onclick="addPlato('Croquetas de la abuela')">Añadir</button></div><div class="price">6,50€</div></li>
        <li class="item" data-allergies="none"><div class="info"><div class="name">Tostas de setas al ajillo</div><div class="desc">Shiitake y boletus salteados al ajo.</div><button class="add-btn" onclick="addPlato('Tostas de setas al ajillo')">Añadir</button></div><div class="price">7,00€</div></li>
        <li class="item" data-allergies="gluten"><div class="info"><div class="name">Pulpo a la brasa</div><div class="desc">Pulpo tierno con papa panadera y pimentón.</div><button class="add-btn" onclick="addPlato('Pulpo a la brasa')">Añadir</button></div><div class="price">12,50€</div></li>
      </ul>
    </section>

  </div>

  <footer style="margin-top:20px; text-align:center; opacity:0.7;">
    <small>Si tiene alergias, consulte al personal. Precios con IVA incluido.</small>
  </footer>
</div>

<div id="pedidoBtn" onclick="abrirPedido()">Ver pedido (0)</div>

<div id="panelPedido">
  <h3>Tu pedido <span class="close-btn" onclick="cerrarPanel()">✕</span></h3>
  <div id="listaPedido"></div>
  <textarea class="nota-general" placeholder="Añadir nota general del pedido..."></textarea>
</div>

<script>
// Tema estilo Apple
const toggle=document.getElementById('theme-toggle');
const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
const savedTheme=localStorage.getItem('theme')||(prefersDark?'dark':'light');
document.documentElement.setAttribute('data-theme',savedTheme);
toggle.checked=savedTheme==='dark';
toggle.addEventListener('change',()=>{
  const newTheme=toggle.checked?'dark':'light';
  document.documentElement.setAttribute('data-theme',newTheme);
  localStorage.setItem('theme',newTheme);
});

let pedido=JSON.parse(localStorage.getItem('pedido')||'[]');
let notaGeneral=localStorage.getItem('notaGeneral')||'';

function actualizarBtn(){const btn=document.getElementById('pedidoBtn');if(pedido.length===0)btn.style.display='none';else{btn.style.display='block';btn.textContent=`Ver pedido (${pedido.length})`;}}actualizarBtn();

function renderPedido(){
  const cont=document.getElementById('listaPedido');
  cont.innerHTML='';
  const countMap={};
  pedido.forEach(p=>{countMap[p]=(countMap[p]||0)+1;});
  for(const [name,count] of Object.entries(countMap)){
    cont.innerHTML+=`<div class="pedido-item" data-name="${name}"><span>${count} × ${name}</span><span class="remove-btn" onclick="removePlato('${name}')">✕</span></div>`;
  }
  const notaArea=document.querySelector('.nota-general');
  notaArea.value=notaGeneral;
  notaArea.oninput=(e)=>{notaGeneral=e.target.value;localStorage.setItem('notaGeneral',notaGeneral);}
}

function addPlato(nombre){
  pedido.push(nombre);
  localStorage.setItem('pedido',JSON.stringify(pedido));
  actualizarBtn();
  if(document.getElementById('panelPedido').style.display==='block') renderPedido();
}

function abrirPedido(){
  document.getElementById('panelPedido').style.display='block';
  renderPedido();
}

function removePlato(name){
  const index=pedido.indexOf(name);
  if(index!==-1)pedido.splice(index,1);
  localStorage.setItem('pedido',JSON.stringify(pedido));
  renderPedido();
  actualizarBtn();
}

function cerrarPanel(){document.getElementById('panelPedido').style.display='none';}

const filterBtns=document.querySelectorAll('.filter-btn');
filterBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
    filterBtns.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const value=btn.dataset.allerg;
    document.querySelectorAll('li.item').forEach(li=>{
      if(value==='none'||li.dataset.allergies.includes(value)) li.style.display='flex';
      else li.style.display='none';
    });
  });
});
</script>

</body>
</html>