<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Zona Kids | Taply</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Outfit:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --brand-color: #FF8C00; 
      --bg-body: #ffffff;
      --bg-card: #f8fafc;
      --text-main: #1e293b;
      --text-sec: #64748b;
      --border: #e2e8f0;
      --radius-fun: 24px;
    }

    [data-theme="dark"] {
      --bg-body: #0a1128;
      --bg-card: #16213e;
      --text-main: #f8fafc;
      --text-sec: #94a3b8;
      --border: #1f2937;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    body {
      margin: 0; font-family: 'Fredoka', sans-serif;
      background: var(--bg-body); color: var(--text-main);
      min-height: 100vh; display: flex; flex-direction: column;
      transition: background 0.4s ease; overflow-x: hidden;
    }

    /* --- HEADER --- */
    header {
      width: 100%; padding: 15px 20px;
      background: var(--bg-card); border-bottom: 2px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; z-index: 100;
    }
    .header-left { font-weight: 700; font-size: 1.1rem; color: var(--brand-color); text-transform: uppercase; letter-spacing: 1px; }
    .header-right { display: flex; align-items: center; gap: 12px; }
    .lang-tag { font-weight: 700; font-size: 0.8rem; color: var(--text-sec); border: 2px solid var(--border); padding: 4px 8px; border-radius: 8px; text-transform: uppercase; }
    .theme-toggle { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--border); background: var(--bg-body); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }

    /* --- HUB MENU --- */
    .hub-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
      width: 100%; max-width: 500px; padding: 25px; margin: 0 auto;
      animation: popIn 0.5s ease-out;
    }
    .game-card {
      background: var(--bg-card); border-radius: var(--radius-fun);
      padding: 30px 15px; display: flex; flex-direction: column;
      align-items: center; cursor: pointer; border: 2px solid var(--border);
      box-shadow: 0 8px 15px rgba(0,0,0,0.05); transition: 0.2s;
    }
    .game-card:active { transform: scale(0.95); }
    .game-icon { font-size: 3rem; margin-bottom: 10px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); }
    .game-title { font-weight: 700; font-size: 1rem; }

    /* --- CONTENEDORES --- */
    .game-wrapper { display: none; flex-direction: column; align-items: center; width: 100%; max-width: 450px; padding: 15px; flex: 1; margin: 0 auto; justify-content: center;}
    .game-wrapper.active { display: flex; animation: slideUp 0.4s ease-out; }

    /* === MEMORY (DISE√ëO LIMPIO) === */
    .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; max-width: 320px; margin: 0 auto; }
    .mem-card { aspect-ratio: 1; perspective: 1000px; cursor: pointer; height: 85px; }
    .mem-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
    .mem-card.flipped .mem-inner { transform: rotateY(180deg); }
    .mem-face { position: absolute; width: 100%; height: 100%; border-radius: 15px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border: 3px solid var(--border); }
    .mem-front { background: var(--brand-color); color: white; font-size: 1.5rem; font-weight: 800; box-shadow: inset 0 0 15px rgba(0,0,0,0.1); }
    .mem-back { background: white; transform: rotateY(180deg); border-color: var(--brand-color); font-size: 2.2rem; }

    /* === MODAL END === */
    .modal-end { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(8px); }
    .modal-content { background: var(--bg-card); padding: 40px 30px; border-radius: 35px; text-align: center; width: 100%; max-width: 340px; border: 4px solid var(--brand-color); }

    /* BOTONES */
    .btn { padding: 16px 25px; border-radius: 20px; border: none; font-weight: 700; font-family: 'Fredoka'; cursor: pointer; font-size: 1rem; width: 100%; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-action { background: var(--brand-color); color: #fff; box-shadow: 0 6px 0 rgba(0,0,0,0.1); }
    .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text-sec); margin-top: 10px; }
    .btn:active { transform: translateY(3px); box-shadow: none; }

    /* PANTALLAS DE INICIO JUEGO */
    .game-intro { text-align: center; width: 100%; background: var(--bg-card); padding: 30px; border-radius: 30px; border: 2px solid var(--border); }

    /* DINO & MOLE */
    #dinoCanvas { background: #fff; border-radius: 20px; border: 4px solid var(--border); width: 100%; height: 180px; }
    .mole-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
    .hole { aspect-ratio: 1; background: #e2e8f0; border-radius: 50%; position: relative; overflow: hidden; border-bottom: 8px solid #cbd5e1; }
    .mole { position: absolute; top: 100%; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; transition: top 0.1s; cursor: pointer; }
    .hole.up .mole { top: 0; }

    .player-tag { background: var(--brand-color); color: white; padding: 8px 15px; border-radius: 12px; margin: 4px; display: inline-block; font-weight: 600; }
    .setup-box { background: var(--bg-card); padding: 20px; border-radius: 25px; width: 100%; border: 3px solid var(--border); text-align: center; }

    @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>

  <header>
    <div class="header-left">ZONA KIDS üé®</div>
    <div class="header-right">
        <div class="lang-tag" id="langDisplay">ES</div>
        <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">‚òÄÔ∏è</button>
    </div>
  </header>

  <div id="hubMenu">
    <div class="hub-grid">
        <div class="game-card" onclick="openGame('memory')">
          <div class="game-icon">üß©</div>
          <div class="game-title" data-t="g1">Parejas</div>
        </div>
        <div class="game-card" onclick="openGame('mole')">
          <div class="game-icon">üç≥</div>
          <div class="game-title" data-t="g2">Caza Chef</div>
        </div>
        <div class="game-card" onclick="openGame('impostor')">
          <div class="game-icon">ü§´</div>
          <div class="game-title" data-t="g3">Impostor</div>
        </div>
        <div class="game-card" onclick="openGame('dino')">
          <div class="game-icon">ü¶ñ</div>
          <div class="game-title" data-t="g4">Dino Run</div>
        </div>
        <button class="btn btn-action" style="grid-column: span 2; margin-top: 15px;" onclick="history.back()">SALIR DE JUEGOS</button>
    </div>
  </div>

  <div id="modalEnd" class="modal-end">
      <div class="modal-content">
          <h2 id="modalMsg">¬°FIN!</h2>
          <p id="modalScore"></p>
          <button class="btn btn-action" id="btnRetry">REINTENTAR üîÑ</button>
          <button class="btn btn-outline" onclick="exitToHub()">MEN√ö üè†</button>
      </div>
  </div>

  <div class="game-wrapper" id="game-dino">
    <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px; font-weight:800;"><span>Score: <span id="dScore">0</span></span></div>
    <canvas id="dinoCanvas"></canvas>
    <button class="btn btn-action" style="margin-top:20px; height:80px;" onmousedown="dJump()" ontouchstart="dJump()">¬°SALTAR! üëÜ</button>
    <button class="btn btn-outline" onclick="exitToHub()">VOLVER</button>
  </div>

  <div class="game-wrapper" id="game-mole">
    <div id="mole-intro" class="game-intro">
        <div class="game-icon">üë®‚Äçüç≥</div>
        <h2>Caza al Chef</h2>
        <p>¬°No dejes que se escape!</p>
        <button class="btn btn-action" onclick="startMoleGame()">EMPEZAR</button>
        <button class="btn btn-outline" onclick="exitToHub()">VOLVER</button>
    </div>
    <div id="mole-active" style="display:none; width:100%;">
        <div style="font-size: 1.5rem; font-weight: 800; margin-bottom: 20px; text-align:center;">Caza: <span id="mScore">0</span></div>
        <div class="mole-grid" id="mGrid"></div>
    </div>
  </div>

  <div class="game-wrapper" id="game-memory">
    <div class="memory-grid" id="memBoard"></div>
    <button class="btn btn-outline" style="margin-top:30px" onclick="exitToHub()">VOLVER</button>
  </div>

  <div class="game-wrapper" id="game-impostor">
      <div id="imp-setup" style="width:100%;">
          <div class="setup-box">
              <input type="text" id="pName" placeholder="Nombre..." style="width:100%; padding:15px; border-radius:15px; border:2px solid var(--border); margin-bottom:15px; font-family:'Fredoka';">
              <button class="btn btn-action" onclick="addP()">A√±adir +</button>
              <div id="pList" style="margin:20px 0;"></div>
              <button class="btn btn-action" id="startImpBtn" disabled onclick="startImp()" style="background:#22c55e">EMPEZAR</button>
              <button class="btn btn-outline" onclick="exitToHub()">VOLVER</button>
          </div>
      </div>
      <div id="imp-play" style="display:none; text-align:center; width:100%;">
          <h2 id="impTurn">Turno</h2>
          <div id="impSecret" style="display:none; font-size:1.8rem; margin:20px 0; color:var(--brand-color); font-weight:800; background:#fff; padding:20px; border-radius:20px; border:4px solid var(--brand-color);"></div>
          <button class="btn btn-action" id="impBtn" onclick="handleImp()">VER PALABRA</button>
      </div>
  </div>

  <script>
    /* L√ìGICA DE TEMA (MODO CLARO / OSCURO) */
    function applySavedTheme() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeBtn').innerText = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }
    applySavedTheme();

    function toggleTheme() {
        const curr = document.documentElement.getAttribute('data-theme');
        const next = curr === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        document.getElementById('themeBtn').innerText = next === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }

    const urlParams = new URLSearchParams(window.location.search);
    const lang = urlParams.get('lang') || 'es';
    const color = urlParams.get('btn') ? '#' + urlParams.get('btn') : '#FF8C00';
    document.documentElement.style.setProperty('--brand-color', color);
    document.getElementById('langDisplay').innerText = lang;

    const dict = {
        es: { g1:"Parejas", g2:"Caza Chef", g3:"Impostor", g4:"Dino Run", retry:"REINTENTAR", view:"VER PALABRA", secret:"IMPOSTOR üòà", start:"EMPIEZA: ", reveal:"REVELAR IMPOSTOR", lost:"¬°SE ESCAP√ì!", win:"¬°GENIO!" },
        en: { g1:"Memory", g2:"Catch Chef", g3:"Impostor", g4:"Dino Run", retry:"RETRY", view:"VIEW WORD", secret:"IMPOSTER üòà", start:"STARTS: ", reveal:"REVEAL IMPOSTER", lost:"HE ESCAPED!", win:"GENIUS!" }
    };
    const t = dict[lang] || dict.es;

    function openGame(id) {
        stopAllGames();
        document.getElementById('hubMenu').style.display = 'none';
        document.getElementById('modalEnd').style.display = 'none';
        document.querySelectorAll('.game-wrapper').forEach(w => w.classList.remove('active'));
        document.getElementById(`game-${id}`).classList.add('active');
        
        if(id !== 'mole') window[`init_${id}`]();
    }

    function exitToHub() {
        stopAllGames();
        location.reload(); 
    }

    function stopAllGames() {
        mActive = false;
        dActive = false;
        if(typeof mTimer !== 'undefined') clearTimeout(mTimer);
    }

    /* PAREJAS (MEMORY) - REDUCIDO A 12 CARTAS */
    function init_memory() {
        const icons = ['üçï','üçî','üçü','üç¶','üç©','üçé']; 
        const deck = [...icons, ...icons].sort(() => Math.random() - 0.5);
        document.getElementById('memBoard').innerHTML = deck.map(i => `<div class="mem-card" onclick="flip(this)"><div class="mem-inner"><div class="mem-face mem-front">?</div><div class="mem-face mem-back">${i}</div></div></div>`).join('');
    }
    let flipped = [];
    function flip(c) {
        if(flipped.length < 2 && !c.classList.contains('flipped')) {
            c.classList.add('flipped'); flipped.push(c);
            if(flipped.length === 2) {
                if(flipped[0].innerText === flipped[1].innerText) {
                    flipped = []; if(document.querySelectorAll('.flipped').length === 12) setTimeout(()=>showGameOver(t.win, "", 'memory'), 600);
                } else {
                    setTimeout(() => { flipped.forEach(x => x.classList.remove('flipped')); flipped = []; }, 800);
                }
            }
        }
    }

    /* CAZA CHEF (MOLE) CON INICIO */
    let mActive = false, mSpeed = 1200, mScore = 0, mTimer;
    function init_mole() {
        document.getElementById('mole-intro').style.display = 'block';
        document.getElementById('mole-active').style.display = 'none';
    }
    function startMoleGame() {
        document.getElementById('mole-intro').style.display = 'none';
        document.getElementById('mole-active').style.display = 'block';
        mActive = true; mScore = 0; mSpeed = 1200;
        document.getElementById('mGrid').innerHTML = Array(9).fill('<div class="hole"><div class="mole" onclick="hitM(this)">üë®‚Äçüç≥</div></div>').join('');
        peepM();
    }
    function peepM() {
        if(!mActive) return;
        const holes = document.querySelectorAll('.hole');
        const h = holes[Math.floor(Math.random()*9)];
        h.classList.add('up');
        mTimer = setTimeout(() => {
            if(h.classList.contains('up') && mActive) { mActive = false; showGameOver(t.lost, mScore, 'mole'); }
            else if(mActive) peepM();
        }, mSpeed);
    }
    function hitM(e) {
        if(!mActive) return; mScore++; e.parentNode.classList.remove('up');
        mSpeed = Math.max(400, mSpeed - 50); document.getElementById('mScore').innerText = mScore;
        if(navigator.vibrate) navigator.vibrate(40);
    }

    /* DINO RUN */
    let dCtx, dActive = false, dScore = 0, dDino, dObs = [], dFrame = 0, dSpeed = 6;
    function init_dino() {
        const canv = document.getElementById('dinoCanvas'); dCtx = canv.getContext('2d');
        canv.width = 400; canv.height = 180;
        dDino = { x: 40, y: 130, dy: 0, jump: -12, grav: 0.7, grounded: true };
        dObs = []; dScore = 0; dActive = true; dFrame = 0; dSpeed = 6;
        requestAnimationFrame(dLoop);
    }
    function dJump() { if(dDino.grounded) { dDino.dy = dDino.jump; dDino.grounded = false; } }
    function dLoop() {
        if(!dActive) return; dCtx.clearRect(0,0,400,180);
        dDino.dy += dDino.grav; dDino.y += dDino.dy;
        if(dDino.y > 130) { dDino.y = 130; dDino.dy = 0; dDino.grounded = true; }
        dCtx.save(); dCtx.translate(dDino.x+20, dDino.y+20); dCtx.scale(-1,1);
        dCtx.font = "40px Arial"; dCtx.fillText("ü¶ñ", -20, 15); dCtx.restore();
        if(dFrame % 80 === 0) {
            let isAir = Math.random() > 0.7;
            dObs.push({ x: 400, y: isAir ? 80 : 135, type: isAir ? "ü¶Ö" : "üåµ" });
        }
        dObs.forEach((o, i) => {
            o.x -= dSpeed; dCtx.font = "30px Arial"; dCtx.fillText(o.type, o.x, o.y+20);
            if(o.x < dDino.x + 25 && o.x + 20 > dDino.x && o.y < dDino.y + 35 && o.y + 25 > dDino.y) {
                dActive = false; showGameOver("¬°BOOM!", dScore, 'dino');
            }
            if(o.x < -40) { dObs.splice(i,1); dScore++; dSpeed += 0.1; }
        });
        document.getElementById('dScore').innerText = dScore;
        dFrame++; requestAnimationFrame(dLoop);
    }

    /* IMPOSTOR CON BOT√ìN VOLVER Y REVELACI√ìN */
    let players = [], impIdx, revIdx, sWord;
    function addP() {
        const n = document.getElementById('pName').value.trim();
        if(n && players.length < 8) { players.push(n); document.getElementById('pName').value = ""; renderP(); }
        document.getElementById('startImpBtn').disabled = players.length < 3;
    }
    function renderP() { document.getElementById('pList').innerHTML = players.map(p => `<span class="player-tag">${p}</span>`).join(''); }
    function startImp() {
        impIdx = Math.floor(Math.random()*players.length); revIdx = 0;
        sWord = ["Pizza", "Sushi", "Taco", "Hamburguesa", "Pasta", "Helado", "Sopa"][Math.floor(Math.random()*7)];
        document.getElementById('imp-setup').style.display = "none";
        document.getElementById('imp-play').style.display = "block";
        updateImpUI();
    }
    function updateImpUI() {
        document.getElementById('impTurn').innerText = players[revIdx];
        document.getElementById('impSecret').style.display = "none";
        document.getElementById('impBtn').innerText = t.view;
    }
    function handleImp() {
        const sec = document.getElementById('impSecret');
        if(sec.style.display === "none") {
            sec.style.display = "block"; sec.innerText = revIdx === impIdx ? t.secret : "PALABRA: " + sWord;
            document.getElementById('impBtn').innerText = "LISTO (OCULTAR)";
        } else {
            revIdx++;
            if(revIdx < players.length) updateImpUI();
            else {
                const starter = players[Math.floor(Math.random()*players.length)];
                document.getElementById('imp-play').innerHTML = `
                    <h2 style="color:var(--brand-color)">¬°A JUGAR!</h2>
                    <p style="font-size:1.3rem">üî• ${t.start} <b>${starter}</b></p>
                    <p style="margin:20px 0; color:var(--text-sec)">Debatid qui√©n es el impostor y pulsad el bot√≥n cuando est√©is listos.</p>
                    <button class="btn btn-action" onclick="revealImpostorFinal()">${t.reveal}</button>
                    <button class="btn btn-outline" onclick="exitToHub()">VOLVER AL MEN√ö</button>
                `;
            }
        }
    }
    function revealImpostorFinal() {
        showGameOver(t.reveal, players[impIdx], 'impostor');
    }

    function showGameOver(m, s, id) {
        document.getElementById('modalEnd').style.display = 'flex';
        document.getElementById('modalMsg').innerText = m;
        document.getElementById('modalScore').innerText = s !== "" ? (id === 'impostor' ? s : "Resultado: " + s) : "";
        document.getElementById('btnRetry').onclick = () => openGame(id);
    }
  </script>
</body>
</html>