<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
<meta name="theme-color" content="#a0715e" />
<title>Feedback - El Buen Bocado</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&display=swap" rel="stylesheet">

<style>
  :root {
    /* --- COLORES EL BUEN BOCADO --- */
    --brand-color: #a0715e; /* Terracota */
    
    --bg-body: #fffbf2;     /* Crema suave */
    --bg-card: #ffffff;
    --text-main: #3e2b26;   /* Caf√© oscuro */
    --text-sec: #8d6e63;    /* Marr√≥n suave */
    --border: #e6ddd0;      /* Borde sutil beige */
    
    --shadow-card: 0 15px 35px -5px rgba(62, 43, 38, 0.08);
    --btn-text: #ffffff;
  }

  [data-theme="dark"] {
    --bg-body: #1e1b1a;
    --bg-card: #2d2420;
    --text-main: #f3e5dc;
    --text-sec: #d7ccc8;
    --border: #3e2b26;
    --shadow-card: 0 10px 25px -5px rgba(0,0,0,0.3);
  }

  *, *::before, *::after { box-sizing: border-box; }

  html { height: 100%; }

  body {
    margin: 0; font-family: 'Outfit', sans-serif;
    background: var(--bg-body); color: var(--text-main);
    
    display: flex; flex-direction: column;
    align-items: center; 
    justify-content: flex-start; 
    
    min-height: 100vh;
    min-height: 100dvh;
    
    padding-top: max(20px, env(safe-area-inset-top));
    padding-bottom: max(30px, env(safe-area-inset-bottom));
    padding-left: 20px;
    padding-right: 20px;
    
    transition: background 0.3s, color 0.3s;
  }

  /* --- CONTROLES SUPERIORES --- */
  .top-controls {
    width: 100%; max-width: 360px;
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 20px;
    margin-top: 10px;
  }

  .back-btn {
    background: transparent; border: none; font-size: 1.5rem;
    cursor: pointer; color: var(--text-main); padding: 5px;
    transition: transform 0.2s;
    line-height: 1;
    display: flex; align-items: center;
  }
  .back-btn:active { transform: scale(0.9); }

  .theme-btn {
    background: var(--bg-card); border: 1px solid var(--border);
    color: var(--text-main); width: 36px; height: 36px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: transform 0.2s; font-size: 1.2rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  .theme-btn:active { transform: scale(0.9); }

  /* --- TARJETA DEL FORMULARIO --- */
  .form-card {
    background: var(--bg-card); 
    width: 100%; max-width: 360px;
    border-radius: 24px; padding: 30px 25px;
    box-shadow: var(--shadow-card); border: 1px solid var(--border);
    text-align: center;
    animation: fadeInUp 0.5s ease-out;
    
    margin-top: auto; margin-bottom: auto;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h1 { margin: 0 0 10px; font-size: 1.6em; font-weight: 800; color: var(--text-main); letter-spacing: -0.5px; }
  p.subtitle { margin: 0 0 30px; font-size: 0.95em; color: var(--text-sec); line-height: 1.5; font-weight: 400; }

  /* --- ESTRELLAS --- */
  .star-container {
    display: flex; justify-content: center; gap: 8px;
    margin-bottom: 30px;
  }
  
  .star {
    font-size: 2.5em; cursor: pointer; color: var(--border);
    transition: transform 0.2s, color 0.2s;
    line-height: 1;
    user-select: none;
  }
  
  .star.active { color: #FFC107; }
  .star:hover { transform: scale(1.1); }

  /* --- INPUTS --- */
  .input-group { margin-bottom: 25px; text-align: left; }
  label { display: block; font-weight: 700; font-size: 0.9em; margin-bottom: 8px; color: var(--text-main); }
  
  textarea {
    width: 100%; padding: 16px; border-radius: 16px;
    border: 2px solid var(--border); background: var(--bg-body);
    font-family: inherit; font-size: 1em; color: var(--text-main);
    resize: none; outline: none; height: 120px;
    transition: border-color 0.3s, background 0.3s;
    appearance: none;
  }
  
  textarea:focus { border-color: var(--brand-color); background: var(--bg-card); }

  /* --- BOT√ìN --- */
  button[type="submit"] {
    width: 100%; padding: 16px; border-radius: 16px; border: none;
    font-size: 1.1em; font-weight: 700; color: white;
    background: var(--brand-color); cursor: pointer;
    box-shadow: 0 10px 25px -5px rgba(160, 113, 94, 0.4);
    transition: transform 0.2s, opacity 0.2s;
    font-family: 'Outfit', sans-serif;
    appearance: none;
  }
  
  button:disabled { opacity: 0.7; cursor: wait; transform: scale(0.98); }
  button:active { transform: scale(0.96); }

</style>
</head>
<body>

<div class="top-controls">
  <button class="back-btn" onclick="history.back()">&#8592;</button>
  <button class="theme-btn" id="themeBtn">‚òÄÔ∏è</button>
</div>

<form class="form-card" id="feedbackForm">
  <h1 id="pageTitle">Tu Opini√≥n</h1>
  <p class="subtitle" id="txtSubtitle">Ay√∫danos a mejorar cont√°ndonos tu experiencia de hoy.</p>

  <div class="input-group" style="text-align:center">
    <label id="lblRating">¬øC√≥mo fue tu experiencia general? *</label>
    <div class="star-container" id="starContainer">
      <span class="star" data-value="1">‚òÖ</span>
      <span class="star" data-value="2">‚òÖ</span>
      <span class="star" data-value="3">‚òÖ</span>
      <span class="star" data-value="4">‚òÖ</span>
      <span class="star" data-value="5">‚òÖ</span>
    </div>
    <input type="hidden" id="ratingInput" required>
  </div>

  <div class="input-group">
    <label id="lblComment">¬øQu√© podemos mejorar? *</label>
    <textarea id="commentInput" placeholder="..." required></textarea>
  </div>

  <button type="submit" id="submitBtn">Enviar Comentario</button>
</form>

<div style="height: 30px; width: 100%;"></div>

<script>
// URL del script de Google Apps Script (Mantenemos la que pasaste o una demo)
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzo4q3MIwWjXgE88lIl5_E8UdsrxNmwGvjQATsZ9rLXoha2EixB5BdozivNJ24W_NYH/exec"; 

const translations = {
  es: {
    title: "Tu Opini√≥n",
    subtitle: "Ay√∫danos a mejorar cont√°ndonos tu experiencia de hoy.",
    lblRating: "¬øC√≥mo fue tu experiencia general? *",
    lblComment: "¬øQu√© podemos mejorar? *",
    placeholder: "La comida estaba...",
    submit: "Enviar Comentario",
    sending: "Enviando...",
    alertStar: "Por favor, selecciona una puntuaci√≥n de estrellas.",
    alertComment: "Por favor, escribe un comentario.",
  },
  en: {
    title: "Your Opinion",
    subtitle: "Help us improve by sharing your experience today.",
    lblRating: "How was your overall experience? *",
    lblComment: "What can we improve? *",
    placeholder: "The food was...",
    submit: "Send Feedback",
    sending: "Sending...",
    alertStar: "Please select a star rating.",
    alertComment: "Please write a comment.",
  },
  de: {
    title: "Ihre Meinung",
    subtitle: "Helfen Sie uns, besser zu werden.",
    lblRating: "Wie war Ihre Erfahrung? *",
    lblComment: "Was k√∂nnen wir verbessern? *",
    placeholder: "Das Essen war...",
    submit: "Feedback senden",
    sending: "Senden...",
    alertStar: "Bitte w√§hlen Sie eine Sternebewertung.",
    alertComment: "Bitte schreiben Sie einen Kommentar.",
  },
  fr: {
    title: "Votre Avis",
    subtitle: "Aidez-nous √† nous am√©liorer.",
    lblRating: "Comment s'est pass√©e votre exp√©rience ? *",
    lblComment: "Que pouvons-nous am√©liorer ? *",
    placeholder: "La nourriture √©tait...",
    submit: "Envoyer",
    sending: "Envoi...",
    alertStar: "Veuillez s√©lectionner une note.",
    alertComment: "Veuillez √©crire un commentaire.",
  },
  it: {
    title: "La Tua Opinione",
    subtitle: "Aiutaci a migliorare la tua esperienza.",
    lblRating: "Com'√® stata la tua esperienza? *",
    lblComment: "Cosa possiamo migliorare? *",
    placeholder: "Il cibo era...",
    submit: "Invia Feedback",
    sending: "Invio...",
    alertStar: "Seleziona un punteggio.",
    alertComment: "Scrivi un commento.",
  }
};

let currentLang = 'es';

function init() {
  // 1. TEMA
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  document.getElementById('themeBtn').innerText = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

  // 2. IDIOMA
  currentLang = localStorage.getItem('userLang') || navigator.language.slice(0, 2);
  if (!translations[currentLang]) currentLang = 'es';
  translateUI();
}

function translateUI() {
  const t = translations[currentLang];
  document.getElementById('pageTitle').innerText = t.title; // T√çTULO TRADUCIDO
  document.getElementById('txtSubtitle').innerText = t.subtitle;
  document.getElementById('lblRating').innerText = t.lblRating;
  document.getElementById('lblComment').innerText = t.lblComment;
  document.getElementById('commentInput').placeholder = t.placeholder;
  document.getElementById('submitBtn').innerText = t.submit;
}

// Cambio de tema
document.getElementById('themeBtn').onclick = () => {
  const current = document.documentElement.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  document.getElementById('themeBtn').innerText = next === 'dark' ? 'üåô' : '‚òÄÔ∏è';
  localStorage.setItem('theme', next);
};

// Estrellas
const stars = document.querySelectorAll('.star');
const ratingInput = document.getElementById('ratingInput');
stars.forEach(star => {
  star.addEventListener('click', () => {
    const val = parseInt(star.dataset.value);
    ratingInput.value = val;
    stars.forEach(s => s.classList.toggle('active', parseInt(s.dataset.value) <= val));
  });
});

// Envio
const form = document.getElementById('feedbackForm');
form.addEventListener('submit', (e) => {
  e.preventDefault();
  const t = translations[currentLang];

  if (!ratingInput.value) { alert(t.alertStar); return; }
  const comment = document.getElementById('commentInput').value.trim();
  if (!comment) { alert(t.alertComment); return; }

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerText = t.sending;

  const data = new FormData();
  data.append('valoracion', ratingInput.value);
  data.append('comentario', comment);
  data.append('origen', 'El Buen Bocado'); 

  // Enviar a Google Sheets (modo no-cors para evitar bloqueo, no recibimos respuesta JSON pero se env√≠a)
  fetch(SCRIPT_URL, { 
    method: 'POST', 
    body: data, 
    mode: 'no-cors',
    keepalive: true 
  }).catch(err => console.log("Env√≠o lanzado"));

  // Redirigir a agradecimiento tras 1s
  setTimeout(() => {
    window.location.href = "elbuenbocadoagradecimiento.html";
  }, 1000);
});

window.onload = init;
</script>
</body>
</html>